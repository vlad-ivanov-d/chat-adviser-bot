generator client {
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-arm64-openssl-3.0.x"]
  provider      = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum AddingBotsRule {
  BAN      @map("ban")
  RESTRICT @map("restrict")
}

enum ChatSettingName {
  ADDING_BOTS      @map("adding_bots")
  LANGUAGE         @map("language")
  PROFANITY_FILTER @map("profanity_filter")
  TIME_ZONE        @map("time_zone")
  VOTEBAN_LIMIT    @map("voteban_limit")
}

enum ChatType {
  CHANNEL    @map("channel")
  GROUP      @map("group")
  PRIVATE    @map("private")
  SUPERGROUP @map("supergroup")
  UNKNOWN    @map("unknown")
}

enum LanguageCode {
  EN @map("en")
  RU @map("ru")
}

enum ProfanityFilterRule {
  FILTER @map("filter")
}

model Chat {
  id              Float                @id
  addingBots      AddingBotsRule?
  admins          User[]               @relation("ChatAdmins")
  authorId        Float
  createdAt       DateTime             @default(now())
  displayTitle    String
  editorId        Float
  firstName       String?
  language        LanguageCode
  lastName        String?
  membersCount    Int
  profanityFilter ProfanityFilterRule?
  timeZone        String
  title           String?
  type            ChatType
  updatedAt       DateTime             @updatedAt
  username        String?
  votebanLimit    Int?

  author              User                  @relation("ChatAuthor", fields: [authorId], references: [id])
  chatSettingsHistory ChatSettingsHistory[]
  editor              User                  @relation("ChatEditor", fields: [editorId], references: [id])
  votebans            Voteban[]

  @@index([displayTitle])
  @@map("chats")
}

model ChatSettingsHistory {
  id          BigInt          @id @default(autoincrement())
  authorId    Float
  chatId      Float
  createdAt   DateTime        @default(now())
  editorId    Float
  settingName ChatSettingName
  updatedAt   DateTime        @updatedAt

  author User @relation("ChatSettingsHistoryAuthor", fields: [authorId], references: [id])
  chat   Chat @relation(fields: [chatId], onDelete: Cascade, references: [id])
  editor User @relation("ChatSettingsHistoryEditor", fields: [editorId], references: [id])

  @@unique([chatId, settingName])
  @@map("chat_settings_history")
}

model SenderChat {
  id        Float    @id
  authorId  Float
  createdAt DateTime @default(now())
  editorId  Float
  firstName String?
  lastName  String?
  title     String?
  type      ChatType
  updatedAt DateTime @updatedAt
  username  String?

  author                      User      @relation("SenderChatAuthor", fields: [authorId], references: [id])
  editor                      User      @relation("SenderChatEditor", fields: [editorId], references: [id])
  votebanAuthorSenderChats    Voteban[] @relation("VotebanAuthorSenderChat")
  votebanCandidateSenderChats Voteban[] @relation("VotebanCandidateSenderChat")

  @@map("sender_chats")
}

model ProfaneWord {
  id        BigInt       @id @default(autoincrement())
  authorId  Float        @map("author_id")
  comment   String?
  createdAt DateTime     @default(now()) @map("created_at")
  editorId  Float        @map("editor_id")
  language  LanguageCode
  updatedAt DateTime     @updatedAt @map("updated_at")
  word      String

  author User @relation("ProfaneWordAuthor", fields: [authorId], references: [id])
  editor User @relation("ProfaneWordEditor", fields: [editorId], references: [id])

  @@unique([word])
  @@map("profane_words")
}

model User {
  id           Float    @id
  authorId     Float
  createdAt    DateTime @default(now())
  editorId     Float
  firstName    String
  languageCode String?
  lastName     String?
  updatedAt    DateTime @updatedAt
  username     String?

  author                     User                  @relation("UserAuthor", fields: [authorId], references: [id])
  chatAdmins                 Chat[]                @relation("ChatAdmins")
  chatAuthors                Chat[]                @relation("ChatAuthor")
  chatEditors                Chat[]                @relation("ChatEditor")
  chatSettingsHistoryAuthors ChatSettingsHistory[] @relation("ChatSettingsHistoryAuthor")
  chatSettingsHistoryEditors ChatSettingsHistory[] @relation("ChatSettingsHistoryEditor")
  editor                     User                  @relation("UserEditor", fields: [editorId], references: [id])
  profaneWordAuthors         ProfaneWord[]         @relation("ProfaneWordAuthor")
  profaneWordEditors         ProfaneWord[]         @relation("ProfaneWordEditor")
  senderChatAuthors          SenderChat[]          @relation("SenderChatAuthor")
  senderChatEditors          SenderChat[]          @relation("SenderChatEditor")
  userAuthors                User[]                @relation("UserAuthor")
  userEditors                User[]                @relation("UserEditor")
  votebanAuthors             Voteban[]             @relation("VotebanAuthor")
  votebanBanVoterAuthors     VotebanBanVoter[]     @relation("VotebanBanVoterAuthor")
  votebanBanVoterEditors     VotebanBanVoter[]     @relation("VotebanBanVoterEditor")
  votebanCandidates          Voteban[]             @relation("VotebanCandidate")
  votebanEditors             Voteban[]             @relation("VotebanEditor")
  votebanNoBanVoterAuthors   VotebanNoBanVoter[]   @relation("VotebanNoBanVoterAuthor")
  votebanNoBanVoterEditors   VotebanNoBanVoter[]   @relation("VotebanNoBanVoterEditor")

  @@index([updatedAt])
  @@map("users")
}

model Voteban {
  id                    BigInt              @id @default(autoincrement())
  authorId              Float
  authorSenderChatId    Float?
  banVoters             VotebanBanVoter[]
  candidateId           Float
  candidateSenderChatId Float?
  chatId                Float
  createdAt             DateTime            @default(now())
  editorId              Float
  isCompleted           Boolean?
  messageId             Float
  noBanVoters           VotebanNoBanVoter[]
  updatedAt             DateTime            @updatedAt

  author              User        @relation("VotebanAuthor", fields: [authorId], references: [id])
  authorSenderChat    SenderChat? @relation("VotebanAuthorSenderChat", fields: [authorSenderChatId], references: [id])
  candidate           User        @relation("VotebanCandidate", fields: [candidateId], references: [id])
  candidateSenderChat SenderChat? @relation("VotebanCandidateSenderChat", fields: [candidateSenderChatId], references: [id])
  chat                Chat        @relation(fields: [chatId], onDelete: Cascade, references: [id])
  editor              User        @relation("VotebanEditor", fields: [editorId], references: [id])

  @@unique([chatId, messageId])
  @@index([createdAt])
  @@map("votebans")
}

model VotebanBanVoter {
  id        BigInt   @id @default(autoincrement())
  authorId  Float    @map("author_id")
  createdAt DateTime @default(now()) @map("created_at")
  editorId  Float    @map("editor_id")
  updatedAt DateTime @updatedAt @map("updated_at")
  votebanId BigInt   @map("voteban_id")

  author  User    @relation("VotebanBanVoterAuthor", fields: [authorId], references: [id])
  editor  User    @relation("VotebanBanVoterEditor", fields: [editorId], references: [id])
  voteban Voteban @relation(fields: [votebanId], onDelete: Cascade, references: [id])

  @@unique([authorId, votebanId])
  @@map("voteban_ban_voters")
}

model VotebanNoBanVoter {
  id        BigInt   @id @default(autoincrement())
  authorId  Float    @map("author_id")
  createdAt DateTime @default(now()) @map("created_at")
  editorId  Float    @map("editor_id")
  updatedAt DateTime @updatedAt @map("updated_at")
  votebanId BigInt   @map("voteban_id")

  author  User    @relation("VotebanNoBanVoterAuthor", fields: [authorId], references: [id])
  editor  User    @relation("VotebanNoBanVoterEditor", fields: [editorId], references: [id])
  voteban Voteban @relation(fields: [votebanId], onDelete: Cascade, references: [id])

  @@unique([authorId, votebanId])
  @@map("voteban_no_ban_voters")
}
